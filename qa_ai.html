t<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Google Sheets Web App Connector</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<style>
  html, body {
    height: 100%; /* Make sure the HTML and body are full height */
    margin: 0; /* Remove default margin */
    padding: 0; /* Remove default padding */
    font-family: Arial, sans-serif; /* Styling the font */
  }
  #leftpanel {
    width: 60%; /* Left panel covers 60% of the screen width */
    height: 80%; /* Stretch to the bottom of the screen */
    float: left; /* Align to the left */
    padding: 20px; /* Space inside the panel */
    box-sizing: border-box; /* Padding and border included in width and height calculation */
    background: #f8f8f8; /* Light grey background for visibility */
  }
  #rightpanel {
    width: 40%; /* Right panel covers the remaining 40% of the screen width */
    height: 80%; /* Stretch to the bottom of the screen */
    float: left; /* Align next to the left panel */
    padding: 20px; /* Space inside the panel */
    box-sizing: border-box; /* Padding and border included in width and height calculation */
    background: #333; /* White background for visibility */
  }

  #aians{
    background:black;
    color:white;
    height:auto;
    padding:10px;
  }
  #prompt{
  width:90%;
  height:100px;
    overflow:auto;
  }
  #lessons{
  background:black;
    color:white;
    font-size:2em;
    padding:5px;
  }
</style>
</head>
<body>
<h1>Questions on topics</h1><div><select id="lessons"></select></div>
<div id="leftpanel">
    <input id="key" value="AKfycbw9DpSFODWxNT4aOjSjBUHj1ND6YstmAy4KVsvljnqE4earR_9FGgcMtEYIgvjD7X0dzw" />
    
<button id="readData">Read Data</button>
    <div id="output" style="border:1px solid black;padding:5px">Data will appear here...</div>


</div><div id="rightpanel">
 
    <textarea id="prompt" placeholder="ask anything else" ></textarea><br><button id="askai">Ask AI</button>
    <div id="aians">
    </div>
<button id="writeData">Write Data</button>
    </div>
<script>
    var key = $("#key").val();
$(document).ready(function() {
    const webAppUrl = 'https://script.google.com/macros/s/'+key+'/exec'; // Replace with your Web App URL
     //fetch subjects
        $.ajax({
            url: webAppUrl,
            type: 'GET', // or 'POST' if your web app is set to handle POST for read
            data: { 'action': 'getsubjects' },
            success: function(response) {
                var output = "";
                for(i=0;i<response.length;i++){
                    r = response[i].toString();
                    r =r.replace(";//;",">");
                    $("#lessons").append("<option value='"+r+"'>"+r+"</option>");
                }
               $('#output').html(output);
            },
            error: function(xhr, status, error) {
                $('#output').html("Error: " + error);
            }
        });
 
    $('#readData').click(function() {
        $.ajax({
            url: webAppUrl,
            type: 'GET', // or 'POST' if your web app is set to handle POST for read
            data: { 'action': 'read' },
            success: function(response) {
                var output = "";
                for(i=0;i<response.length;i++){
                    r = response[i].toString();
                    console.log(r);
                    qas = (r).split(";//;");
                     
                     output += ("<h3>"+ qas[0]+"</h3><div>"+qas[1]+"</div>");
                    //output += response[i] + "<br>";
                }
               $('#output').html(output);
            },
            error: function(xhr, status, error) {
                $('#output').html("Error: " + error);
            }
        });
    });
     $('#askai').click(function() {
        $.ajax({
            url: webAppUrl,
            type: 'GET', // or 'POST' if your web app is set to handle POST for read
            data: { 'action': 'askai', 'prompt': "subject:"+$("#lessons").val()+";question:"+$("#prompt").val() },
            success: function(response) {
             
               $('#aians').html(response);
               
            },
            error: function(xhr, status, error) {
                $('#output').html("Error: " + error);
            }
        });
    });

    $('#writeData').click(function() {
        $.ajax({
            url: webAppUrl,
            type: 'GET', // Change to 'POST' if using doPost in your Google Script
            data: { 'action': 'write' , 'prompt':$("#prompt").val()+';//;'+$("#aians").text()+';//;'+$("#lessons").val()},
            success: function(response) {
               // $('#output').html(response);
                
                 $('#readData').click(); 
            },
            error: function(xhr, status, error) {
                $('#output').html("Error: " + error);
            }
        });
    });
  $('#readData').click();
});
</script>
</body>
</html>
