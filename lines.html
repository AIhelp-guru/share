<html>
<body>
    <br><input id="lw" placeholder="linewidth"/>
    <br><input id="ls" placeholder="linespacing"/>
    <br><input id="an" placeholder="angle"/>
    <button id="go" onclick="redraw()">Go</button><br>
    <img id="sourceImage"  />
    <div id="painting"></div>
<script>function convertToLineHalftone(img, maxLineWidth, lineSpacing, angle) {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');

  canvas.width = img.width;
  canvas.height = img.height;

  // Draw the original image on the canvas
  ctx.drawImage(img, 0, 0);

  // Get the image data
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const data = imageData.data;

  // Clear the canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  ctx.fillStyle = 'black';

  // Loop through every pixel row
  for (let y = 0; y < canvas.height; y += lineSpacing) {
      // Loop through every pixel column
      for (let x = 0; x < canvas.width; x++) {
          // Get the color at the current pixel
          const index = (y * canvas.width + x) * 4;
          const darkness = 255 - data[index]; // Assuming the image is in grayscale, just take the red channel

          // Determine line width based on darkness
          const lineWidth = darkness / 255 * maxLineWidth;

          // Draw the line segment at the current position
          ctx.save();
          ctx.translate(x, y);
          ctx.rotate((Math.PI / 180) * angle);

          // The line is drawn from the center of the pixel, so we offset by half the line width
          ctx.fillRect(-lineWidth / 2, 0, lineWidth, lineSpacing);

          ctx.restore();
      }
  }

  return canvas;
}

// The rest of your JavaScript remains the same.

function redraw(){
     const img = document.getElementById('sourceImage');
     const lw = parseInt(document.getElementById('lw').value);
     const ls = parseInt(document.getElementById('ls').value);
     const an = parseInt(document.getElementById('an').value);
      ha = convertToLineHalftone(img, lw, ls, an);
      console.log(ha);
     document.getElementById("painting").innerHTML = "";
       document.getElementById("painting").appendChild(ha);
}
// Usage:
// Assuming you have an <img id="sourceImage" src="image.jpg">
// and you want to transform it and put the result into <canvas id="halftoneCanvas">
window.onload = function() {
  const img = document.getElementById('sourceImage');
  img.onload = function() {
      
    const halftoneCanvas = convertToLineHalftone(img, 2, 2, 45);
    document.getElementById("painting").innerHTML = "";
       document.getElementById("painting").appendChild(halftoneCanvas);
  };
  img.src = 'sample.jpg'; // Set the source to your image
};
</script>
</body>
</html>
